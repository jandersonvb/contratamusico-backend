generator client {
  provider = "prisma-client-js"
}

generator sharedClient {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model booking {
  id                Int             @id @default(autoincrement())
  musicianProfileId Int
  clientId          Int?
  eventDate         DateTime
  eventType         String
  message           String
  status            String
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  user              user?           @relation(fields: [clientId], references: [id], map: "Booking_clientId_fkey")
  musicianprofile   musicianprofile @relation(fields: [musicianProfileId], references: [id], map: "Booking_musicianProfileId_fkey")

  @@index([clientId], map: "Booking_clientId_fkey")
  @@index([musicianProfileId], map: "Booking_musicianProfileId_fkey")
}

model contactmessage {
  id        Int      @id @default(autoincrement())
  firstName String
  lastName  String
  email     String
  phone     String?
  subject   String
  message   String
  createdAt DateTime @default(now())
}

model conversation {
  id                              Int       @id @default(autoincrement())
  lastMessageAt                   DateTime  @default(now())
  createdAt                       DateTime  @default(now())
  userAId                         Int
  userBId                         Int
  user_conversation_userAIdTouser user      @relation("conversation_userAIdTouser", fields: [userAId], references: [id], onDelete: Cascade, map: "Conversation_userAId_fkey")
  user_conversation_userBIdTouser user      @relation("conversation_userBIdTouser", fields: [userBId], references: [id], onDelete: Cascade, map: "Conversation_userBId_fkey")
  message                         message[]

  @@unique([userAId, userBId], map: "Conversation_userAId_userBId_key")
  @@index([lastMessageAt], map: "Conversation_lastMessageAt_idx")
  @@index([userAId], map: "Conversation_userAId_idx")
  @@index([userBId], map: "Conversation_userBId_idx")
}

model faqitem {
  id        Int      @id @default(autoincrement())
  question  String   @db.Text
  answer    String   @db.Text
  category  String?
  createdAt DateTime @default(now())
}

model favorite {
  id                Int             @id @default(autoincrement())
  userId            Int
  musicianProfileId Int
  createdAt         DateTime        @default(now())
  musicianprofile   musicianprofile @relation(fields: [musicianProfileId], references: [id], onDelete: Cascade, map: "Favorite_musicianProfileId_fkey")
  user              user            @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Favorite_userId_fkey")

  @@unique([userId, musicianProfileId], map: "Favorite_userId_musicianProfileId_key")
  @@index([musicianProfileId], map: "Favorite_musicianProfileId_idx")
  @@index([userId], map: "Favorite_userId_idx")
}

model genre {
  id            Int             @id @default(autoincrement())
  name          String          @unique(map: "Genre_name_key")
  slug          String          @unique(map: "Genre_slug_key")
  musiciangenre musiciangenre[]
}

model instrument {
  id                 Int                  @id @default(autoincrement())
  name               String               @unique(map: "Instrument_name_key")
  slug               String               @unique(map: "Instrument_slug_key")
  musicianinstrument musicianinstrument[]
}

model message {
  id             Int          @id @default(autoincrement())
  conversationId Int
  senderId       Int
  content        String       @db.Text
  isRead         Boolean      @default(false)
  createdAt      DateTime     @default(now())
  conversation   conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade, map: "Message_conversationId_fkey")
  user           user         @relation(fields: [senderId], references: [id], map: "Message_senderId_fkey")

  @@index([conversationId], map: "Message_conversationId_idx")
  @@index([isRead], map: "Message_isRead_idx")
  @@index([senderId], map: "Message_senderId_idx")
}

model musiciangenre {
  musicianProfileId Int
  genreId           Int
  genre             genre           @relation(fields: [genreId], references: [id], map: "MusicianGenre_genreId_fkey")
  musicianprofile   musicianprofile @relation(fields: [musicianProfileId], references: [id], map: "MusicianGenre_musicianProfileId_fkey")

  @@id([musicianProfileId, genreId])
  @@index([genreId], map: "MusicianGenre_genreId_fkey")
}

model musicianinstrument {
  musicianProfileId Int
  instrumentId      Int
  instrument        instrument      @relation(fields: [instrumentId], references: [id], map: "MusicianInstrument_instrumentId_fkey")
  musicianprofile   musicianprofile @relation(fields: [musicianProfileId], references: [id], map: "MusicianInstrument_musicianProfileId_fkey")

  @@id([musicianProfileId, instrumentId])
  @@index([instrumentId], map: "MusicianInstrument_instrumentId_fkey")
}

model musicianprofile {
  id                 Int                  @id @default(autoincrement())
  userId             Int                  @unique(map: "MusicianProfile_userId_key")
  category           String?
  bio                String?
  location           String?
  priceFrom          Int?
  experience         String?
  equipment          String?
  availability       String?
  rating             Float                @default(0)
  ratingCount        Int                  @default(0)
  eventsCount        Int                  @default(0)
  satisfactionRate   Int?
  responseTime       String?
  isFeatured         Boolean              @default(false)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  booking            booking[]
  favorite           favorite[]
  musiciangenre      musiciangenre[]
  musicianinstrument musicianinstrument[]
  user               user                 @relation(fields: [userId], references: [id], map: "MusicianProfile_userId_fkey")
  portfolioitem      portfolioitem[]
  review             review[]
}

model notificationpreference {
  id            Int      @id @default(autoincrement())
  userId        Int      @unique(map: "NotificationPreference_userId_key")
  emailBookings Boolean  @default(true)
  emailMessages Boolean  @default(true)
  emailReviews  Boolean  @default(true)
  emailNews     Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime
  user          user     @relation(fields: [userId], references: [id], onDelete: Cascade, map: "NotificationPreference_userId_fkey")
}

model paymenthistory {
  id              Int      @id @default(autoincrement())
  userId          Int
  amount          Int
  currency        String   @default("BRL")
  status          String
  stripePaymentId String?  @unique(map: "PaymentHistory_stripePaymentId_key")
  description     String?
  createdAt       DateTime @default(now())
  user            user     @relation(fields: [userId], references: [id], onDelete: Cascade, map: "PaymentHistory_userId_fkey")

  @@index([status], map: "PaymentHistory_status_idx")
  @@index([userId], map: "PaymentHistory_userId_idx")
}

model plan {
  id             Int            @id @default(autoincrement())
  title          String         @unique(map: "Plan_title_key")
  description    String?
  monthlyPrice   Int
  yearlyPrice    Int
  badge          String?
  isMusicianPlan Boolean
  isClientPlan   Boolean
  createdAt      DateTime       @default(now())
  hasSpotlight   Boolean        @default(false)
  hasStatistics  Boolean        @default(false)
  hasWhatsapp    Boolean        @default(false)
  maxPhotos      Int?
  maxVideos      Int?
  planfeature    planfeature[]
  subscription   subscription[]
}

model planfeature {
  id        Int     @id @default(autoincrement())
  planId    Int
  text      String
  available Boolean
  highlight Boolean
  plan      plan    @relation(fields: [planId], references: [id], map: "PlanFeature_planId_fkey")

  @@index([planId], map: "PlanFeature_planId_fkey")
}

model portfolioitem {
  id                Int                @id @default(autoincrement())
  musicianProfileId Int
  type              portfolioitem_type
  fileKey           String
  title             String
  description       String?
  date              String?
  location          String?
  genre             String?
  createdAt         DateTime           @default(now())
  musicianprofile   musicianprofile    @relation(fields: [musicianProfileId], references: [id], map: "PortfolioItem_musicianProfileId_fkey")

  @@index([musicianProfileId], map: "PortfolioItem_musicianProfileId_fkey")
}

model review {
  id                Int             @id @default(autoincrement())
  musicianProfileId Int
  clientId          Int
  rating            Int
  content           String
  date              String
  event             String
  createdAt         DateTime        @default(now())
  user              user            @relation(fields: [clientId], references: [id], map: "Review_clientId_fkey")
  musicianprofile   musicianprofile @relation(fields: [musicianProfileId], references: [id], map: "Review_musicianProfileId_fkey")

  @@index([clientId], map: "Review_clientId_fkey")
  @@index([musicianProfileId], map: "Review_musicianProfileId_fkey")
}

model subscription {
  id                   Int      @id @default(autoincrement())
  userId               Int      @unique(map: "Subscription_userId_key")
  planId               Int
  stripeSubscriptionId String?  @unique(map: "Subscription_stripeSubscriptionId_key")
  stripeCustomerId     String?
  status               String
  currentPeriodStart   DateTime
  currentPeriodEnd     DateTime
  cancelAtPeriodEnd    Boolean  @default(false)
  createdAt            DateTime @default(now())
  updatedAt            DateTime
  plan                 plan     @relation(fields: [planId], references: [id], map: "Subscription_planId_fkey")
  user                 user     @relation(fields: [userId], references: [id], onDelete: Cascade, map: "Subscription_userId_fkey")

  @@index([planId], map: "Subscription_planId_idx")
  @@index([status], map: "Subscription_status_idx")
  @@index([userId], map: "Subscription_userId_idx")
}

model user {
  id                                      Int                     @id @default(autoincrement())
  email                                   String                  @unique(map: "User_email_key")
  passwordHash                            String
  firstName                               String
  lastName                                String
  phone                                   String?
  city                                    String?
  state                                   String?
  userType                                user_userType
  role                                    user_role               @default(USER)
  profileImageKey                         String?
  resetToken                              String?                 @unique(map: "User_resetToken_key")
  resetTokenExpiry                        DateTime?
  createdAt                               DateTime                @default(now())
  updatedAt                               DateTime
  booking                                 booking[]
  conversation_conversation_userAIdTouser conversation[]          @relation("conversation_userAIdTouser")
  conversation_conversation_userBIdTouser conversation[]          @relation("conversation_userBIdTouser")
  favorite                                favorite[]
  message                                 message[]
  musicianprofile                         musicianprofile?
  notificationpreference                  notificationpreference?
  paymenthistory                          paymenthistory[]
  review                                  review[]
  subscription                            subscription?
}

enum portfolioitem_type {
  IMAGE
  VIDEO
  AUDIO
}

enum user_userType {
  CLIENT
  MUSICIAN
}

enum user_role {
  USER
  ADMIN
}
